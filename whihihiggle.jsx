// whihihiggle.jsx// this script adds a wiggle expression to the selected properties.// Copyright (c)  2012 // Fabian "fabiantheblind" Morón Zirfas  // http://fabiantheblind.info// Permission is hereby granted, free of charge, to any // person obtaining a copy of this software and associated// documentation files (the "Software"), to deal in the Software// without restriction, including without limitation the rights // to use, copy, modify, merge, publish, distribute, sublicense,// and/or sell copies of the Software, and to  permit persons to // whom the Software is furnished to do so, subject to // the following conditions:  // The above copyright notice and this permission notice// shall be included in all copies or substantial portions of the Software.  // THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.// IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF  CONTRACT,// TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTIO// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.  // see also http://www.opensource.org/licenses/mit-license.php{meta = {    "freq": 1,     "amp":25,    "seed": 100,    "octaves": 1,    "amp_mult": 0.5,    "t": 1,    "framesPerSecond": 1,    "loopTime": 5 ,    "ctrlname": "whihihiggle_control",    "ctrlExists": false,    "addSeedRandom": true,    "addPosterizeTime": false,    "addLoop": true,    "addTemporal": false,     "addTime": true,     "simple": false,    "theWebsite": "http://fabiantheblind.info"    };main(meta);function main(meta){app.beginUndoGroup("whihihiggle");    var curComp = app.project.activeItem;    if (!curComp || !(curComp instanceof CompItem))    {        alert("Please select a Composition.");        return;    };    var theExpression = buildExpression(meta);    var props = new Array(); app.beginSuppressDialogs();// dont want any warnings    var myLayers = curComp.selectedLayers;    if(myLayers.length > 0){        for (var i = 0; i < myLayers.length; i++){            var lprops = myLayers[i].selectedProperties;        for(var j = 0; j < lprops.length; j++){            props.push(lprops[j]);          };        };if((!meta.ctrlExists)&&(meta.simple == false)) createController(curComp, meta);for (var i = props.length - 1; i >= 0; i--) {  p = props[i];              if(p.canSetExpression == true){                p.expression = theExpression.join("\n");                p.expressionEnabled = true;            };}; app.endSuppressDialogs(false);}else{            alert("Please select at least one layer.");    return;    };// alert("reomved "+theLayers.length+" effects from selection");app.endUndoGroup();}function buildExpression (meta) {var theExpression = new Array();if(meta.simple ==false){theExpression.push("layer = thisComp.layer('"+ meta.ctrlname +"'); // <-- THE CONTROL LAYER");theExpression.push("\n/* ------------------------------- */\n");theExpression.push("\n/* -----THE SLIDER CONTROLS------- */\n");theExpression.push("freq = layer.effect('freq')('ADBE Slider Control-0001');");theExpression.push("amp = layer.effect('amp')('ADBE Slider Control-0001');");theExpression.push("seed = layer.effect('seed')('ADBE Slider Control-0001');");theExpression.push("octaves = layer.effect('octaves')('ADBE Slider Control-0001');");theExpression.push("amp_mult = layer.effect('amp_mult')('ADBE Slider Control-0001');");theExpression.push("t = layer.effect('t')('ADBE Slider Control-0001');");theExpression.push("framesPerSecond = layer.effect('framesPerSecond')('ADBE Slider Control-0001');");theExpression.push("loopTime = layer.effect('loopTime')('ADBE Slider Control-0001');\n");theExpression.push("\n/* ------------------------------- */\n");var seed = "// seedRandom(seed);\r";if(meta.addSeedRandom){    seed = seed.substring(3);};theExpression.push(seed);var posterize = "// posterizeTime(framesPerSecond);\n";if((meta.addPosterizeTime == true)&&(meta.addLoop == false)){    posterize = posterize.substring(3);};theExpression.push(posterize);var theWiggle = "";var theTemporalWiggle = "";if(meta.addPosterizeTime == true){        theTemporalWiggle = "// temporalWiggle(freq, amp,octaves, amp_mult);\n";         theWiggle = "// wiggle(freq,amp,octaves, amp_mult)\n";      }else if(meta.addPosterizeTime == false){        theWiggle = "// wiggle(freq,amp,octaves,amp_mult,t)\n";        theTemporalWiggle = "// temporalWiggle(freq, amp, octaves, amp_mult, t);\n";};if(meta.addLoop == false){    if(meta.addTemporal == true){        theTemporalWiggle = theTemporalWiggle.substring(3);    }else if(meta.addTemporal == false){        theWiggle = theWiggle.substring(3);    };};theExpression.push(theWiggle);theExpression.push(theTemporalWiggle);theExpression.push("\n/* ------------------------------- */\n");theExpression.push("// Thanx to Dan Ebberst");theExpression.push("// Expressionieer's Designer Guide");theExpression.push("// Loop wiggle()");theExpression.push("// http://www.motionscript.com/design-guide/looping-wiggle.html\n");var loop_l1 = "// tLooped = t % loopTime;";var loop_l2 = "// wiggle1 = wiggle(freq, amp, octaves, amp_mult, tLooped);";var loop_l3 = "// wiggle2 = wiggle(freq, amp, octaves, amp_mult, tLooped - loopTime);";var loop_l4 = "// linear(tLooped, 0,  loopTime, wiggle1, wiggle2)";if (meta.addLoop == true) {    loop_l1 = loop_l1.substring(3);    loop_l2 = loop_l2.substring(3);    loop_l3 = loop_l3.substring(3);    loop_l4 = loop_l4.substring(3);};theExpression.push(loop_l1);theExpression.push(loop_l2);theExpression.push(loop_l3);theExpression.push(loop_l4);theExpression.push("\n/* ------------------------------- */\n");theExpression.push("// created with whihihiggle script by fabiantheblind\n// checkout --> " + meta.theWebsite +"\n\n");}else{theExpression.push("wiggle("+meta.freq+","+meta.amp+")");}    return theExpression;}function createController(curComp, meta){    var ctrl = curComp.layers.addNull();    ctrl.name = meta.ctrlname;    ctrl.source.name = meta.ctrlname;var freq = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    freq.name = "freq";    freq.property("ADBE Slider Control-0001").setValue(meta.freq);var amp = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    amp.name = "amp";    amp.property("ADBE Slider Control-0001").setValue(meta.amp);var seed = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    seed.name = "seed";    seed.property("ADBE Slider Control-0001").setValue(meta.seed);var octaves = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    octaves.name = "octaves";    octaves.property("ADBE Slider Control-0001").setValue(meta.octaves);var amp_mult = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    amp_mult.name = "amp_mult";    amp_mult.property("ADBE Slider Control-0001").setValue(meta.amp_mult);var t = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    t.name = "t";    t.property("ADBE Slider Control-0001").setValue(meta.t);    t.property("ADBE Slider Control-0001").expression = "time";var framesPerSecond = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    framesPerSecond.name = "framesPerSecond";    framesPerSecond.property("ADBE Slider Control-0001").setValue(meta.framesPerSecond);var loopTime = ctrl("ADBE Effect Parade").addProperty("ADBE Slider Control");    loopTime.name = "loopTime";    loopTime.property("ADBE Slider Control-0001").setValue(meta.loopTime);};}